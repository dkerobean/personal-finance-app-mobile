# Status

Draft

---

# Story

**As a** user,
**I want** to track my goal progress with visual indicators and manage contributions to my savings goals,
**so that** I can monitor my progress and stay motivated to achieve my financial objectives.

---

# Acceptance Criteria

1. The user can view their goal progress with visual progress bars showing percentage completed.
2. The user can manually add contributions to their savings goals from any screen.
3. The user can see a detailed progress timeline with contribution history and milestones.
4. The user can view projected completion dates based on current progress and monthly targets.
5. The user can receive progress notifications and encouragement based on milestone achievements.
6. The user can link automatic contributions from transactions using category or merchant matching.

Source: `docs/prd/epic-4-goal-setting-savings.md#story-42-goal-progress-tracking-visualization`

---

# Tasks / Subtasks

- [ ] Progress Visualization Components (AC: 1)
  - [ ] Create `GoalProgressBar` component with animated progress indicator [Source: architecture/source-tree.md#Component Structure]
  - [ ] Design progress percentage display with color-coded status (red <50%, yellow 50-80%, green >80%)
  - [ ] Add progress ring component for circular progress display alternative
  - [ ] Implement responsive progress visualization for different screen sizes
  - [ ] Create progress comparison view for multiple goals

- [ ] Manual Contribution Interface (AC: 2)
  - [ ] Create `AddContributionModal` component with amount input and validation [Source: architecture/source-tree.md#Component Structure]
  - [ ] Add floating action button on goals screen for quick contributions
  - [ ] Implement contribution form with goal selection dropdown
  - [ ] Add contribution date picker for backdated entries
  - [ ] Create contribution confirmation dialog with progress update preview
  - [ ] Implement contribution success animation and feedback

- [ ] Progress Timeline & History (AC: 3)
  - [ ] Design `GoalTimelineView` component showing contribution history [Source: architecture/source-tree.md#Component Structure]
  - [ ] Create timeline item component for individual contributions and milestones
  - [ ] Add filtering and sorting options for timeline (by date, amount, type)
  - [ ] Implement timeline pagination for goals with many contributions
  - [ ] Create milestone markers on timeline (25%, 50%, 75%, 100%)
  - [ ] Add timeline export functionality for PDF/CSV formats

- [ ] Projection & Analytics (AC: 4)
  - [ ] Create projection calculation service for completion date forecasting [Source: architecture/source-tree.md#Service Organization]
  - [ ] Implement trend analysis for contribution patterns
  - [ ] Add projection adjustment based on irregular contributions
  - [ ] Create "if-then" scenario calculator (if I save X more per month...)
  - [ ] Display projected completion dates with confidence intervals
  - [ ] Add savings rate analysis and recommendations

- [ ] Progress Notifications (AC: 5)
  - [ ] Integrate with OneSignal service for milestone notifications [Source: architecture/source-tree.md#Authentication Service]
  - [ ] Create notification templates for different milestone types
  - [ ] Implement progress-based notification scheduling
  - [ ] Add celebration animations for major milestones
  - [ ] Create motivational messages based on progress patterns
  - [ ] Add notification preferences in settings

- [ ] Automatic Contribution Linking (AC: 6)
  - [ ] Create `ContributionMatcher` service for transaction analysis [Source: architecture/source-tree.md#Service Organization]
  - [ ] Implement category-based automatic contribution detection
  - [ ] Add merchant name matching for specific savings transfers
  - [ ] Create confirmation flow for suggested automatic contributions
  - [ ] Add rules engine for custom contribution matching patterns
  - [ ] Implement contribution reversal for accidental matches

- [ ] Backend Progress API (AC: All)
  - [ ] Create `supabase/functions/goal-progress/index.ts` Edge Function [Source: architecture/source-tree.md#Backend Repository Structure]
  - [ ] Implement POST /goal-progress/contributions endpoint for adding contributions
  - [ ] Implement GET /goal-progress/:goalId endpoint for progress details
  - [ ] Create GET /goal-progress/:goalId/timeline endpoint for history
  - [ ] Add PUT /goal-progress/contributions/:id endpoint for contribution updates
  - [ ] Implement DELETE /goal-progress/contributions/:id endpoint
  - [ ] Add proper JWT authentication and RLS policies [Source: architecture/tech-stack.md#Authentication]

- [ ] Data Models & Database (AC: All)
  - [ ] Create contributions table with foreign key to goals [Source: architecture/tech-stack.md#Database]
  - [ ] Define Contribution interface in `src/types/models.ts` [Source: architecture/source-tree.md#Type Definitions]
  - [ ] Add progress calculation stored procedures for performance
  - [ ] Create milestone tracking table for notification history
  - [ ] Implement contribution triggers for automatic goal amount updates
  - [ ] Add indexes for efficient progress queries

- [ ] State Management Enhancement (AC: All)
  - [ ] Extend `src/stores/goalStore.ts` with contribution management [Source: architecture/tech-stack.md#State Management]
  - [ ] Add contribution CRUD operations to goal store
  - [ ] Implement progress calculation selectors
  - [ ] Add timeline state management with pagination
  - [ ] Create notification state management
  - [ ] Add contribution matching state and preferences

- [ ] Services Integration (AC: All)
  - [ ] Extend `src/services/goalService.ts` with progress operations [Source: architecture/source-tree.md#Service Organization]
  - [ ] Create contribution service for CRUD operations
  - [ ] Implement progress calculation service
  - [ ] Add notification scheduling service integration
  - [ ] Create contribution matching service
  - [ ] Add analytics and projection service

- [ ] Testing (AC: All)
  - [ ] Unit tests: Progress calculations, contribution logic, projections [Source: architecture/tech-stack.md#Frontend Testing]
  - [ ] Component tests: Progress bars, contribution forms, timeline view [Source: architecture/tech-stack.md#Frontend Testing]
  - [ ] API tests: All progress endpoints, contribution operations [Source: architecture/tech-stack.md#Backend Testing]
  - [ ] Integration tests: Full contribution workflow, automatic matching
  - [ ] Performance tests: Progress calculations with large datasets
  - [ ] Edge case tests: Zero contributions, negative amounts, future dates

---

# Dev Notes

## Previous Story Dependencies
Building on Story 4.1 foundations:
- Requires Goal and GoalCategory models from Story 4.1 implementation
- Extends existing goal store with progress tracking capabilities
- Uses established goal creation UI patterns for contribution forms
- Leverages existing authentication and navigation structure

## Data Models
Progress tracking data structures: [Source: architecture/tech-stack.md#Database]
```typescript
export interface Contribution {
  id: string;
  goal_id: string;
  user_id: string;
  amount: number;
  description?: string;
  transaction_id?: string; // for automatic matching
  contribution_date: string; // ISO date string
  contribution_type: 'manual' | 'automatic' | 'transfer';
  created_at: string;
  updated_at: string;
}

export interface GoalProgress {
  goal_id: string;
  current_amount: number;
  target_amount: number;
  progress_percentage: number;
  total_contributions: number;
  projected_completion_date?: string;
  days_remaining?: number;
  monthly_average: number;
  last_contribution_date?: string;
}

export interface Milestone {
  id: string;
  goal_id: string;
  percentage: number;
  achieved: boolean;
  achieved_date?: string;
  notification_sent: boolean;
}
```

## Progress Calculation Logic
Goal progress calculations and business rules:
- Progress percentage: (current_amount / target_amount) * 100
- Projected completion: Based on average monthly contributions and remaining amount
- Monthly average: Total contributions / months since goal creation
- Contribution validation: Must be positive, cannot exceed reasonable daily limits
- Milestone triggers: Automatic milestone detection at 25%, 50%, 75%, 100%
- Timeline resolution: Group contributions by day/week/month based on volume

## API Specifications
Progress tracking endpoints: [Source: architecture/tech-stack.md#API Style]
- POST /goal-progress/contributions: Add new contribution with validation
- GET /goal-progress/:goalId: Get comprehensive progress details
- GET /goal-progress/:goalId/timeline: Paginated contribution history
- PUT /goal-progress/contributions/:id: Update contribution details
- DELETE /goal-progress/contributions/:id: Remove contribution
- GET /goal-progress/:goalId/projections: Get completion projections
- All endpoints require JWT authentication [Source: architecture/tech-stack.md#Authentication]

## Component Specifications
Progress tracking UI components: [Source: architecture/source-tree.md#Component Structure]
- **GoalProgressBar**: Animated progress bar with percentage and status colors
- **AddContributionModal**: Full-screen modal for adding contributions
- **GoalTimelineView**: Scrollable timeline with contribution history
- **ProgressProjections**: Chart showing projected completion scenarios
- **MilestoneIndicator**: Visual milestone markers with celebration animations
- **ContributionCard**: Individual contribution display in timeline
- **ProgressStats**: Summary statistics component

## File Locations
Progress tracking implementation: [Source: architecture/source-tree.md#Frontend Repository Structure]
- Components: `src/components/features/goals/GoalProgressBar/`, `AddContributionModal/`, `GoalTimelineView/`
- Services: `src/services/contributionService.ts`, `progressCalculationService.ts`
- Store extensions: Enhanced `src/stores/goalStore.ts` with progress state
- Types: Extended `src/types/models.ts` with Contribution interfaces

Backend progress system: [Source: architecture/source-tree.md#Backend Repository Structure]
- Edge Functions: `supabase/functions/goal-progress/index.ts`, `handlers/contributions.ts`
- Database: Migration for contributions and milestones tables
- Services: Progress calculation and notification services
- Triggers: Automatic goal amount updates on contribution changes

## State Management Extensions
Enhanced goals store for progress tracking: [Source: architecture/tech-stack.md#State Management]
```typescript
interface GoalStore {
  // Existing from Story 4.1
  goals: Goal[];
  categories: GoalCategory[];
  
  // New for Story 4.2
  contributions: Contribution[];
  milestones: Milestone[];
  progressData: Record<string, GoalProgress>;
  
  // Progress Actions
  addContribution: (contribution: CreateContributionRequest) => Promise<boolean>;
  updateContribution: (id: string, updates: Partial<Contribution>) => Promise<boolean>;
  deleteContribution: (id: string) => Promise<boolean>;
  loadContributions: (goalId: string) => Promise<void>;
  calculateProgress: (goalId: string) => GoalProgress;
  
  // Selectors
  getGoalProgress: (goalId: string) => GoalProgress;
  getContributionHistory: (goalId: string) => Contribution[];
  getMilestones: (goalId: string) => Milestone[];
  getProjectedCompletion: (goalId: string) => Date | null;
}
```

## Notification Integration
Progress notification system: [Source: architecture/source-tree.md#Authentication Service]
- OneSignal integration for milestone notifications
- Notification templates for different achievement levels
- User preferences for notification frequency and types
- Celebration animations synchronized with notifications
- Progress sharing capabilities via deep links

## Performance Considerations
Progress system optimization: [Source: architecture/tech-stack.md#Performance]
- Database indexes on goal_id and contribution_date for timeline queries
- Cached progress calculations to reduce computational overhead
- Paginated timeline loading for goals with many contributions
- Optimistic UI updates for immediate feedback
- Background sync for contribution matching
- Debounced progress recalculation on rapid contributions

## Security Requirements
Progress data protection: [Source: architecture/tech-stack.md#Security]
- RLS policies ensure users only access their contributions [Source: architecture/tech-stack.md#Database]
- Input validation for contribution amounts and dates
- Audit trail for all contribution modifications
- Rate limiting on contribution creation to prevent abuse
- Secure handling of automatic transaction matching data

## Integration Points
Integration with existing systems:
- **Epic 1**: Uses existing user authentication and profile system
- **Epic 2**: Integration with transaction data for automatic contribution matching
- **Epic 3**: Potential budget integration for savings vs. spending analysis
- **Story 4.1**: Direct extension of goal creation and management functionality

## Business Logic Constraints
Progress tracking business rules:
- Minimum contribution: $0.01 (prevent zero/negative contributions)
- Maximum daily contributions: $10,000 (prevent accidental large entries)
- Contribution date range: Cannot be future-dated beyond today
- Goal completion: Automatically mark as completed when >= 100%
- Milestone notifications: Only sent once per milestone per goal
- Contribution editing: Allow editing within 24 hours of creation

## Testing Requirements
Comprehensive progress system testing: [Source: architecture/tech-stack.md#Testing]
- Unit tests: Progress calculations, milestone detection, projection algorithms
- Component tests: Progress bars, contribution forms, timeline interactions
- API tests: All progress endpoints with various contribution scenarios
- Integration tests: End-to-end contribution workflow, notification flow
- Performance tests: Progress calculations with 1000+ contributions
- Edge cases: Goal completion, negative scenarios, concurrent contributions

## UI/UX Requirements
Progress interface design requirements:
- Clear visual feedback for all contribution actions
- Smooth animations for progress updates and milestone celebrations
- Intuitive contribution flow with minimal steps
- Progress visualization accessible to users with color blindness
- Timeline performance optimized for smooth scrolling
- Empty states for goals without contributions yet

---

# Change Log

| Date       | Version | Description                               | Author |
| ---------- | ------- | ----------------------------------------- | ------ |
| 2025-08-24 | 1.0     | Initial story draft created (SM)          | Bob    |

---

## Dev Agent Record

*This section will be populated by the development agent during implementation*

---

## QA Results

*This section will be populated by the QA agent during testing*