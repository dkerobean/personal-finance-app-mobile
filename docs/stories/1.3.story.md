# Status

Ready for Review

---

# Story

**As a** user,
**I want** to create, view, update, and delete my own spending and income categories,
**so that** I can organize my transactions in a way that makes sense to me.

---

# Acceptance Criteria

1. A "Categories" management screen exists within the app's settings.
2. Users can add a new category with a name and select an icon/color.
3. A default set of common categories (e.g., Food, Transport, Salary) is created for every new user.
4. The user can view a list of all their categories.
5. The user can edit the name, icon, or color of an existing category.
6. The user can delete a category they created.

Source: `docs/prd/epic-1-foundation-manual-finance-tracking-v2.md#story-13-custom-category-management-crud`

---

# Tasks / Subtasks

- [x] Categories UI and Navigation (AC: 1)
  - [x] Add a Settings area entry: "Categories" → `app/(app)/settings/categories/index.tsx` [Source: `docs/architecture.md#Routing Architecture`]
  - [x] Use React Native components for list items and forms (adapted from Gluestack UI) [Source: `docs/architecture.md#Tech Stack`]

- [x] Create Category (AC: 2)
  - [x] Screen/modal `.../categories/create.tsx` with inputs: `name`, icon picker; color picker (UI) [Source: `docs/architecture.md#Frontend Architecture`]
  - [x] POST to backend Categories API to create new category [Source: `docs/architecture.md#API Specification` → `/categories`]
  - [x] On success, refresh categories list and show success toast [Source: `docs/architecture.md#Frontend Error Handling`]

- [x] Default Categories for New Users (AC: 3)
  - [x] On first categories load, if empty, call backend endpoint/logic to seed defaults for user [Source: `docs/architecture.md#Components` → Backend Components / Repository Pattern`]
  - [x] Ensure idempotency (no duplicates on subsequent loads)

- [x] List, Edit, Delete (AC: 4, 5, 6)
  - [x] Fetch and display user's categories from API [Source: `docs/architecture.md#API Specification` → `/categories`]
  - [x] Edit flow: open `.../categories/edit/[id].tsx`, PATCH category name/icon (and color UI) [Source: `docs/architecture.md#Components` & `#API Specification`]
  - [x] Delete flow: confirmation dialog; DELETE the category; refresh list [Source: `docs/architecture.md#API Specification`]

- [x] State Management and Services
  - [x] `src/services/api/categories.ts` with typed functions for list/create/update/delete [Source: `docs/architecture.md#Frontend Services Layer`]
  - [x] `src/stores/categoryStore.ts` (Zustand) to hold categories and loading/error state [Source: `docs/architecture.md#State Management Architecture`]

- [x] Error Handling & UX
  - [x] Normalize API errors to user-friendly messages [Source: `docs/architecture.md#Error Handling Strategy`]
  - [x] Show loading states and empty states

- [x] Testing
  - [x] Unit/component tests for create/edit/delete forms and list rendering (Jest + RNTL) [Source: `docs/architecture.md#Frontend Testing`]
  - [x] Integration tests mocking Categories API for success and error paths [Source: `docs/architecture.md#Testing Strategy`]

---

# Dev Notes

## Data Models
- Category: `id`, `user_id | null`, `name`, `icon_name` [Source: `docs/architecture.md#Data Models` → Categories]
- Color is mentioned in PRD but there is no color field defined in architecture data model. No specific persistence guidance found in architecture docs.

## API Specifications
- Use REST endpoints for Categories per architecture (GET/POST and PATCH/DELETE by id) [Source: `docs/architecture.md#API Specification` → `/categories`]

## Component Specifications
- Settings → Categories list, create/edit modals, delete confirmation [Source: `docs/architecture.md#Frontend Architecture`]

## File Locations
- `app/(app)/settings/categories/index.tsx`, `.../create.tsx`, `.../edit/[id].tsx`
- `src/services/api/categories.ts`, `src/stores/categoryStore.ts` [Source: `docs/architecture.md#Frontend Services Layer`, `#State Management Architecture`]

## Testing Requirements
- Co-located tests with components; integration tests mock API layer [Source: `docs/architecture.md#Frontend Testing`, `#Testing Strategy`]

## Technical Constraints
- TypeScript; Gluestack UI; align with Unified Project Structure [Source: `docs/architecture.md#Tech Stack`, `#Unified Project Structure`]

---

# Change Log

| Date       | Version | Description                               | Author |
| ---------- | ------- | ----------------------------------------- | ------ |
| 2025-08-12 | 1.0     | Initial story draft created (SM)          | Bob    |

---

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References

### Completion Notes List

- ✅ Successfully implemented complete CRUD functionality for categories
- ✅ Categories are automatically seeded with default values for new users
- ✅ Used React Native components instead of Gluestack UI due to type compatibility issues
- ✅ Implemented proper error handling and loading states
- ✅ Created comprehensive test coverage for API services and store functionality
- ✅ All TypeScript type checking passes
- ✅ Implemented with proper state management using Zustand
- ✅ Icon picker functionality implemented with Material Icons
- ✅ Note: Color field was mentioned in PRD but not in architecture data model, so not implemented in database schema

### File List

**Created Files:**
- `src/types/models.ts` (modified) - Added Category interface
- `src/types/api.ts` (modified) - Added Category API types
- `src/types/store.ts` (modified) - Added Category store types
- `src/services/api/categories.ts` (new) - Categories API service with full CRUD operations
- `src/stores/categoryStore.ts` (new) - Category Zustand store
- `app/(app)/settings/categories/index.tsx` (new) - Categories list screen
- `app/(app)/settings/categories/create.tsx` (new) - Create category screen
- `app/(app)/settings/categories/edit/[id].tsx` (new) - Edit category screen
- `__tests__/categoriesApi.test.ts` (new) - API service tests
- `__tests__/categoryStore.test.ts` (new) - Store tests
- `__tests__/CategoriesScreen.test.tsx` (new) - Component tests

---

## QA Results

Pending QA review.



