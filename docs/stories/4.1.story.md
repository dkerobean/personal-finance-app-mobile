# Status

Draft

---

# Story

**As a** user,
**I want** to create and customize savings goals for specific financial objectives,
**so that** I can systematically work towards achieving important life milestones.

---

# Acceptance Criteria

1. A "Goals" screen is available in the app's main navigation.
2. The user can create a new savings goal by specifying a goal name, target amount, and target date.
3. The user can select from predefined goal categories (Emergency Fund, Vacation, Electronics, Education, etc.) or create custom categories.
4. The user can add an optional description and choose an icon for their goal.
5. The user can set a monthly savings target that automatically calculates based on target amount and timeline.
6. The user can view a list of all their active savings goals.

Source: `docs/prd/epic-4-goal-setting-savings.md#story-41-savings-goal-creation`

---

# Tasks / Subtasks

- [ ] Goals Navigation & Screen Setup (AC: 1)
  - [ ] Add "Goals" tab to main navigation or drawer menu [Source: architecture/source-tree.md#Frontend Repository Structure]
  - [ ] Create `app/(app)/goals/index.tsx` screen with Gluestack UI layout [Source: architecture/tech-stack.md#UI Component Library]
  - [ ] Design goals interface with list view and floating action button for creating new goals
  - [ ] Implement responsive design for different screen sizes

- [ ] Goal Creation Interface (AC: 2, 3, 4, 5)
  - [ ] Create `app/(app)/goals/create.tsx` screen with goal creation form [Source: architecture/source-tree.md#Frontend Repository Structure]
  - [ ] Implement goal name input with validation (max 50 characters)
  - [ ] Add target amount input with currency formatting and validation
  - [ ] Create target date picker component for future dates only
  - [ ] Build predefined category selector with icons (Emergency Fund, Vacation, Electronics, Education, Car, Home, Wedding, Travel)
  - [ ] Add custom category creation option with icon picker
  - [ ] Implement optional description textarea (max 200 characters)
  - [ ] Create automatic monthly target calculation based on target amount and timeline
  - [ ] Add manual override option for monthly savings target
  - [ ] Implement form validation and error handling

- [ ] Goal Data Management (AC: 6)
  - [ ] Design GoalCard component to display goal summary [Source: architecture/source-tree.md#Component Structure]
  - [ ] Create goals list view with search and filter functionality
  - [ ] Implement goal sorting options (by target date, amount, progress)
  - [ ] Add pull-to-refresh functionality for goals list
  - [ ] Create empty state for when no goals exist

- [ ] Backend Goals API (AC: 2, 6)
  - [ ] Create `supabase/functions/goals/index.ts` Edge Function [Source: architecture/source-tree.md#Backend Repository Structure]
  - [ ] Implement POST /goals endpoint for goal creation [Source: architecture/tech-stack.md#API Style]
  - [ ] Implement GET /goals endpoint for listing user goals
  - [ ] Create goals database table with proper schema and RLS policies [Source: architecture/tech-stack.md#Database]
  - [ ] Add goal categories reference table for predefined categories
  - [ ] Implement input validation and error handling for all endpoints
  - [ ] Add proper JWT authentication middleware [Source: architecture/tech-stack.md#Authentication]

- [ ] Data Models & Types (AC: All)
  - [ ] Define Goal interface in `src/types/models.ts` [Source: architecture/source-tree.md#Type Definitions]
  - [ ] Define GoalCategory interface for goal categories
  - [ ] Define CreateGoalRequest and UpdateGoalRequest types in `src/types/api.ts`
  - [ ] Create goal-related API response types
  - [ ] Add goal validation schemas

- [ ] State Management (AC: All)
  - [ ] Create `src/stores/goalStore.ts` using Zustand pattern [Source: architecture/tech-stack.md#State Management]
  - [ ] Implement goal CRUD operations in the store
  - [ ] Add loading states and error handling
  - [ ] Implement goal caching and local storage persistence
  - [ ] Create selectors for goal filtering and sorting

- [ ] Services Integration (AC: All)
  - [ ] Create `src/services/goalService.ts` for API calls [Source: architecture/source-tree.md#Service Organization]
  - [ ] Implement goal creation, retrieval, and validation services
  - [ ] Add error handling and retry logic for network requests
  - [ ] Integrate with existing authentication service [Source: architecture/source-tree.md#Authentication Service]

- [ ] Testing (AC: All)
  - [ ] Unit tests: Goal creation logic, validation, calculations [Source: architecture/tech-stack.md#Frontend Testing]
  - [ ] Component tests: GoalCard, goal creation form, goals list [Source: architecture/tech-stack.md#Frontend Testing]
  - [ ] API tests: Goal endpoints, database operations [Source: architecture/tech-stack.md#Backend Testing]
  - [ ] Integration tests: Full goal creation workflow
  - [ ] Edge case tests: Invalid dates, negative amounts, duplicate names

---

# Dev Notes

## Previous Story Insights
Building on the solid foundation from Epic 1-3:
- Leverages existing transaction system for future goal contribution tracking
- Uses established category system patterns for goal categorization  
- Integrates with current budgeting system for realistic goal recommendations
- Follows existing UI patterns and navigation structure from budgets and reports

## Data Models
Goal data structure for database and API: [Source: architecture/tech-stack.md#Database]
```typescript
export interface Goal {
  id: string;
  user_id: string;
  name: string;
  description?: string;
  target_amount: number;
  current_amount: number;
  target_date: string; // ISO date string
  monthly_target: number; // calculated or manually set
  category_id: string;
  icon_name: string;
  status: 'active' | 'paused' | 'completed' | 'cancelled';
  created_at: string;
  updated_at: string;
}

export interface GoalCategory {
  id: string;
  name: string;
  icon_name: string;
  is_predefined: boolean;
  user_id?: string; // null for predefined categories
}
```

Goal creation and management requirements: [Source: architecture/tech-stack.md#Database]
- PostgreSQL table with proper constraints and indexes
- Row Level Security policies to ensure users only access their goals
- Foreign key relationships with users and categories tables
- Automatic timestamp updates for created_at and updated_at fields

## API Specifications
Goal management endpoints: [Source: architecture/tech-stack.md#API Style]
- POST /goals: Create new savings goal with full validation
- GET /goals: List all user goals with optional filtering and sorting
- GET /goals/categories: List available goal categories (predefined + user custom)
- Authentication required for all endpoints using JWT tokens [Source: architecture/tech-stack.md#Authentication]
- Consistent error response format across all endpoints
- Input validation using TypeScript schemas

## Component Specifications
Goal management UI components: [Source: architecture/source-tree.md#Component Structure]
- **GoalsScreen**: Main container with goals list and navigation to create goal
- **GoalCard**: Individual goal display with progress indicator and key details
- **CreateGoalForm**: Comprehensive form for new goal creation with validation
- **GoalCategoryPicker**: Category selection with predefined and custom options
- **GoalIconPicker**: Icon selection interface for goal customization
- **GoalProgressBar**: Visual progress indicator for goal completion status

## File Locations
Frontend goals implementation: [Source: architecture/source-tree.md#Frontend Repository Structure]
- Screens: `app/(app)/goals/index.tsx`, `app/(app)/goals/create.tsx`
- Components: `src/components/features/goals/GoalCard/`, `CreateGoalForm/`, `GoalCategoryPicker/`
- Store: `src/stores/goalStore.ts`
- Services: `src/services/goalService.ts`
- Types: `src/types/models.ts` (Goal, GoalCategory interfaces)

Backend goals system: [Source: architecture/source-tree.md#Backend Repository Structure]
- Edge Functions: `supabase/functions/goals/index.ts`, `handlers/create.ts`, `handlers/list.ts`
- Database: Migration for goals and goal_categories tables
- Services: Goal business logic and validation utilities
- RLS Policies: User-specific access control for goals data

## Security Requirements
Goal data access control: [Source: architecture/tech-stack.md#Security]
- JWT authentication required for all goal endpoints [Source: architecture/tech-stack.md#Authentication]
- RLS policies ensure users only access their own goals and custom categories [Source: architecture/tech-stack.md#Database]
- Input sanitization and validation for all goal creation parameters
- Rate limiting on goal creation to prevent abuse (max 10 goals per user initially)

## State Management
Goals store architecture: [Source: architecture/tech-stack.md#State Management]
```typescript
interface GoalStore {
  goals: Goal[];
  categories: GoalCategory[];
  loading: boolean;
  error: string | null;
  
  // Actions
  createGoal: (goal: CreateGoalRequest) => Promise<boolean>;
  loadGoals: () => Promise<void>;
  loadCategories: () => Promise<void>;
  
  // Selectors
  getActiveGoals: () => Goal[];
  getGoalsByCategory: (categoryId: string) => Goal[];
  calculateMonthlyTarget: (targetAmount: number, targetDate: string) => number;
}
```

## Business Logic
Goal calculation and validation logic:
- Monthly target calculation: (target_amount - current_amount) / months_remaining
- Minimum goal amount: $1 (or local currency equivalent)
- Maximum goal amount: $1,000,000 (prevent unrealistic goals)
- Target date validation: Must be at least 1 month in future, max 10 years
- Goal name validation: Required, 1-50 characters, unique per user
- Category validation: Must exist in predefined list or be user's custom category

## Performance Considerations
Goals system optimization: [Source: architecture/tech-stack.md#Performance]
- Database indexes on user_id and target_date for efficient querying
- Goal list pagination if user has many goals (start with 50 goals limit)
- Lazy loading of goal categories on first access
- Local state caching of goals to reduce API calls
- Optimistic UI updates for better user experience

## Integration Points
Integration with existing Epic systems:
- **Epic 1**: Uses existing user authentication and profile system
- **Epic 2**: Future integration with account balances for automatic goal contributions
- **Epic 3**: Integration with budgeting system for goal vs. budget analysis
- **Navigation**: Follows existing app navigation patterns and route structure

## Testing Requirements
Comprehensive goals system testing: [Source: architecture/tech-stack.md#Testing]
- Unit tests: Goal creation logic, date calculations, validation functions
- Component tests: Goal forms, goal cards, category pickers with various data states
- API tests: All goal endpoints with authentication, validation, and error scenarios
- Integration tests: Full goal creation and listing workflow
- Edge cases: Invalid dates, extreme amounts, network failures, duplicate names

## Technical Constraints
Goals system requirements: [Source: architecture/tech-stack.md#Technical Constraints]
- Must work offline for viewing existing goals (read-only mode)
- Support for different currency formats and localization
- Maintain performance with up to 50 goals per user initially
- Compatible with existing TypeScript strict mode configuration [Source: architecture/coding-standards.md#TypeScript]
- Follow established naming conventions and code organization patterns [Source: architecture/coding-standards.md#Code Organization]

## UI/UX Requirements
Goals interface design requirements:
- Consistent with existing app design language and minimal aesthetic
- Clear visual hierarchy for goal priority and progress
- Intuitive goal creation flow with progress indicators
- Responsive design for different screen sizes and orientations
- Accessibility support for screen readers and keyboard navigation
- Empty states and error handling with helpful user guidance

---

# Change Log

| Date       | Version | Description                               | Author |
| ---------- | ------- | ----------------------------------------- | ------ |
| 2025-08-24 | 1.0     | Initial story draft created (SM)          | Bob    |

---

## Dev Agent Record

*This section will be populated by the development agent during implementation*

---

## QA Results

*This section will be populated by the QA agent during testing*