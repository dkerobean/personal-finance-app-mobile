# Status

Draft

---

# Story

**As a** user,
**I want** to view a simple report of my income and expenses for the month,
**so that** I can understand my overall cash flow.

---

# Acceptance Criteria

1. A "Reports" screen is available in the app.
2. The user can select any of the last 12 months to view a report.
3. The report clearly displays the total income and total expenses for the selected month.
4. The report includes a simple visual breakdown of expenses by category (e.g., a pie chart or a categorized list).
5. The data presented in the report is accurate and reflects all transactions for that month.

Source: `docs/prd/epic-3-budgeting-reporting-alerts.md#story-34-basic-monthly-report`

---

# Tasks / Subtasks

- [ ] Reports Navigation & Screen Setup (AC: 1)
  - [ ] Add "Reports" tab to main navigation or settings section [Source: architecture.md#Routing Architecture]
  - [ ] Create `app/(app)/reports/index.tsx` screen with Gluestack UI layout [Source: architecture.md#Frontend Architecture → Component Architecture]
  - [ ] Design intuitive reports interface with month selector and chart area

- [ ] Month Selection Interface (AC: 2)
  - [ ] Create MonthPicker component for last 12 months selection [Source: architecture.md#Tech Stack → UI Component Library]
  - [ ] Implement month navigation (previous/next buttons and dropdown)
  - [ ] Default to current month on screen load
  - [ ] Store selected month in component state for persistence
  - [ ] Handle month transitions smoothly with loading states

- [ ] Financial Summary Display (AC: 3)
  - [ ] Create MonthlySummaryCard showing total income and expenses [Source: architecture.md#Frontend Architecture → Component Architecture]
  - [ ] Calculate net income (income - expenses) with clear positive/negative indication
  - [ ] Display currency amounts with proper formatting and locale support
  - [ ] Add comparison indicators (vs previous month) for context
  - [ ] Show summary statistics (number of transactions, average transaction amount)

- [ ] Category Breakdown Visualization (AC: 4)
  - [ ] Implement CategoryBreakdownChart component (pie chart or bar chart)
  - [ ] Group expenses by category with amounts and percentages
  - [ ] Use category colors/icons from Epic 1 for visual consistency [Source: architecture.md#Data Models → Categories]
  - [ ] Add interactive chart features (tap category to see details)
  - [ ] Include legend with category names, amounts, and percentages

- [ ] Data Accuracy & Aggregation (AC: 5)
  - [ ] Create GET /reports/monthly/{month} endpoint for report data [Source: architecture.md#API Specification]
  - [ ] Implement accurate transaction aggregation by month and category
  - [ ] Include both manual and synced transactions (if Epic 2 implemented) [Source: architecture.md#Data Models → Transactions]
  - [ ] Handle timezone considerations for month boundaries
  - [ ] Validate data integrity and handle edge cases (deleted categories, etc.)

- [ ] Backend Report Generation
  - [ ] Create reports service with monthly aggregation logic [Source: architecture.md#Components → Budgeting Service]
  - [ ] Implement efficient SQL queries for transaction summarization
  - [ ] Add database indexes for optimal report query performance [Source: architecture.md#Security and Performance → Performance Optimization]
  - [ ] Create reusable aggregation functions for income/expense totals
  - [ ] Handle large datasets with proper pagination if needed

- [ ] Advanced Report Features
  - [ ] Add month-over-month comparison functionality
  - [ ] Implement expense trend analysis (spending patterns)
  - [ ] Create exportable report data (CSV or PDF future enhancement)
  - [ ] Add budget vs actual spending comparison (integration with Stories 3.1-3.2)
  - [ ] Include top spending categories and largest transactions

- [ ] Data Visualization Components
  - [ ] Choose and implement charting library (Victory Native or similar)
  - [ ] Create reusable PieChart component for category breakdown
  - [ ] Implement responsive chart design for different screen sizes
  - [ ] Add chart interactions (highlighting, tooltips, drill-down)
  - [ ] Handle empty data states gracefully (no transactions for month)

- [ ] State Management & Caching
  - [ ] Create reportsStore using Zustand pattern [Source: architecture.md#Frontend Architecture → State Management Architecture]
  - [ ] Implement report data caching to avoid redundant API calls
  - [ ] Add loading states for report generation
  - [ ] Handle report data refresh when underlying transactions change
  - [ ] Optimize performance with memoized calculations

- [ ] Testing
  - [ ] Unit tests: Report calculations, aggregation accuracy, month filtering [Source: architecture.md#Testing Strategy → Backend Testing]
  - [ ] Component tests: Chart rendering, month selection, summary display [Source: architecture.md#Testing Strategy → Frontend Testing]
  - [ ] Integration tests: Full report generation workflow
  - [ ] Data accuracy tests: Verify report totals match transaction sums
  - [ ] Visual tests: Chart rendering and responsiveness

---

# Dev Notes

## Previous Story Insights
Integrates with entire app ecosystem:
- Uses transaction data from Epic 1 (Stories 1.4, 1.5) and potentially Epic 2 synced transactions
- Can incorporate budget data from Stories 3.1-3.2 for budget vs actual comparisons
- Leverages category system from Epic 1 (Story 1.3) for breakdown visualization

## Data Models
Report data structure for API responses:
```typescript
export interface MonthlyReport {
  month: string; // 'YYYY-MM' format
  totalIncome: number;
  totalExpenses: number;
  netIncome: number; // totalIncome - totalExpenses
  transactionCount: number;
  categoryBreakdown: CategorySpending[];
}

export interface CategorySpending {
  categoryId: string;
  categoryName: string;
  categoryIcon: string;
  totalAmount: number;
  percentage: number; // percentage of total expenses
  transactionCount: number;
}
```

Transaction aggregation requirements: [Source: architecture.md#Data Models → Transactions]
- Filter by transaction_date within month boundaries
- Group by category_id and type (income/expense)
- Sum amounts for each category
- Include both manual (is_synced=false) and synced (is_synced=true) transactions

## API Specifications
Monthly report endpoints: [Source: architecture.md#API Specification]
- GET /reports/monthly/{month}: Returns complete monthly report data
- GET /reports/summary: Returns last 12 months summary for trend analysis
- Query parameters: include_budgets (boolean) to add budget comparison data
- Response includes aggregated data, category breakdowns, and metadata

## Component Specifications
Report visualization components: [Source: architecture.md#Frontend Architecture → Component Architecture]
- **ReportsScreen**: Main container with month selection and report display
- **MonthPicker**: Month selection interface with last 12 months
- **MonthlySummaryCard**: Income/expense totals with net income calculation
- **CategoryBreakdownChart**: Pie chart or bar chart for expense categories
- **ReportMetrics**: Additional metrics (avg transaction, category counts)

## File Locations
Frontend reports implementation: [Source: architecture.md#Unified Project Structure → Frontend Repository]
- Screen: `app/(app)/reports/index.tsx`
- Components: `src/components/reports/ReportsScreen.tsx`, `MonthlySummaryCard.tsx`, `CategoryBreakdownChart.tsx`
- Store: `src/stores/reportsStore.ts`
- Services: `src/services/reportsService.ts`

Backend reports system: [Source: architecture.md#Unified Project Structure → Backend Repository]
- Edge Functions: `supabase/functions/reports/`
- Shared: Report aggregation utilities in shared services
- Integration with existing transaction and category services

## Security Requirements
Report data access control: [Source: architecture.md#Security Requirements]
- JWT authentication required for all report endpoints [Source: architecture.md#Security Requirements → Authentication Security]
- RLS policies ensure users only access their own transaction data [Source: architecture.md#Backend Architecture → Authentication and Authorization]
- Validate date ranges to prevent excessive historical data requests
- Sanitize and validate all report parameters

## State Management
Reports store architecture: [Source: architecture.md#Frontend Architecture → State Management Architecture]
```typescript
interface ReportsStore {
  currentReport: MonthlyReport | null;
  selectedMonth: string; // 'YYYY-MM' format
  loading: boolean;
  error: string | null;
  
  // Actions
  fetchMonthlyReport: (month: string) => Promise<void>;
  setSelectedMonth: (month: string) => void;
  refreshReport: () => Promise<void>;
  
  // Selectors
  getCurrentMonthReport: () => MonthlyReport | null;
  getCategoryBreakdown: () => CategorySpending[];
}
```

## Business Logic
Report calculation logic:
- Month boundaries: Use first and last day of selected month for filtering
- Currency precision: Handle decimal calculations accurately
- Category grouping: Group uncategorized transactions appropriately
- Percentage calculations: (categoryAmount / totalExpenses) * 100
- Handle zero divisions and empty data gracefully

## Performance Considerations
Report generation optimization: [Source: architecture.md#Security and Performance → Performance Optimization]
- Database indexes on transaction_date and category_id for fast aggregation
- Cache frequently accessed report data (current month, previous month)
- Lazy loading for chart components to improve initial screen load
- Pagination for detailed transaction lists within categories
- Efficient memory usage for large datasets

## Visualization Requirements
Chart implementation considerations:
- Choose lightweight charting library compatible with React Native
- Support for pie charts, bar charts, and potentially line charts for trends
- Responsive design that works on different screen sizes
- Accessibility support for chart data (screen readers, alternative text)
- Color schemes that work with app theme and are colorblind-friendly

## Testing Requirements
Comprehensive reporting system testing: [Source: architecture.md#Testing Strategy]
- Data accuracy: Verify report calculations match raw transaction data
- Chart rendering: Test visualization components with various data sets
- Month selection: Test boundary conditions and date handling
- Performance testing: Large transaction datasets and report generation speed
- Edge cases: Empty months, single category, very large amounts

## Technical Constraints
Reporting system requirements:
- Must handle different currencies and decimal precision appropriately
- Support for different date formats and localization
- Maintain performance with growing transaction history
- Charts must be accessible and work across iOS and Android
- Report data should be exportable for future enhancements

---

# Change Log

| Date       | Version | Description                               | Author |
| ---------- | ------- | ----------------------------------------- | ------ |
| 2025-08-12 | 1.0     | Initial story draft created (SM)          | Bob    |

---

## Dev Agent Record

### Agent Model Used
{{agent_model_name_version}}

### Debug Log References

### Completion Notes List

### File List

---

## QA Results

Pending QA review.